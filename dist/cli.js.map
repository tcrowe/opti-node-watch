{"version":3,"sources":["../src/cli.js"],"names":["minimist","require","isArray","isNumber","isFinite","isString","isNil","createWatcher","msg","args","process","argv","w","watch","ext","d","delay","exec","script","help","debug","watcherOpts","watchPatterns","restartDelay","extensions","console","log","exit","push","concat","split","forEach","item","execFound","reduce","op","arg","trim","watcher","addListener","err","stderr","write","evt","stdout","pipe","start"],"mappings":"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","sourcesContent":["#!/usr/bin/env opti-node\n\n/*\n\nopti-node-watch cli app\n\nAPI doc in ../readme.md\n\n*/\n\nconst minimist = require(\"minimist\");\nconst isArray = require(\"lodash/isArray\");\nconst isNumber = require(\"lodash/isNumber\");\nconst isFinite = require(\"lodash/isFinite\");\nconst isString = require(\"lodash/isString\");\nconst isNil = require(\"lodash/isNil\");\nconst { createWatcher } = require(\".\");\nconst msg = require(\"./lib/msg\");\nconst args = minimist(process.argv);\nconst { w, watch, ext, d, delay, exec, script, help, debug } = args;\n\nconst watcherOpts = {\n  watchPatterns: [],\n  restartDelay: 0,\n  extensions: [\"js\", \"jsx\", \"json\"],\n  exec: \"\",\n  script: \"\",\n  debug: false\n};\n\nif (isNil(help) === false) {\n  console.log(`\n  opti-node-watch\n\n  Watch these directories or files. (required, no default)\n  -w dist/client\n  --watch dist/server\n  -w dist/shared\n  -w dist/index.js\n  --watch package.json\n\n  ---\n\n  Extensions: (optional, default: js,jsx,json)\n  --ext js,jsx,ts,tsx,json\n\n  Use of --ext is comma-separated without spaces.\n\n  ---\n\n  Reload delay in milliseconds: (optional)\n  -d 1000\n  --delay 1000\n\n  ---\n\n  Command to execute: (optional, default: opti-node)\n  --exec node\n  --exec python\n\n  ---\n\n  Which script to run: (required, no default)\n  --script dist/index.js\n\n  ---\n\n  Debug, show which events happen:\n  --debug\n\n  ---\n\n  Help:\n  --help\n  `);\n  process.exit();\n}\n\n//\n// -w\n//\n\nif (isString(w) === true) {\n  watcherOpts.watchPatterns.push(w);\n}\n\nif (isArray(w) === true) {\n  watcherOpts.watchPatterns = watcherOpts.watchPatterns.concat(w);\n}\n\n//\n// --watch\n//\nif (isString(watch) === true) {\n  watcherOpts.watchPatterns.push(watch);\n}\n\nif (isArray(watch) === true) {\n  watcherOpts.watchPatterns = watcherOpts.watchPatterns.concat(watch);\n}\n\n//\n// --ext\n//\n\nif (isString(ext) === true) {\n  ext.split(\",\").forEach(item => watcherOpts.extensions.push(item));\n}\n\nif (isArray(ext) === true) {\n  watcherOpts.extensions = watcherOpts.extensions.concat(ext);\n}\n\n//\n// -d\n//\n\nif (isNumber(d) === true && isFinite(d) === true) {\n  watcherOpts.restartDelay = d;\n}\n\n//\n// --delay\n//\n\nif (isNumber(delay) === true && isFinite(delay) === true) {\n  watcherOpts.restartDelay = delay;\n}\n\n//\n// --exec\n//\n\nif (isString(exec) === true) {\n  // watcherOpts.exec = exec;\n  let execFound = false;\n\n  watcherOpts.exec = process.argv\n    .reduce((op, arg) => {\n      if (execFound === true) {\n        return `${op} ${arg}`;\n      }\n\n      if (arg === \"--exec\") {\n        execFound = true;\n      }\n\n      return op;\n    }, \"\")\n    .trim();\n}\n\n//\n// --script\n//\n\nif (isString(script) === true) {\n  watcherOpts.script = script;\n}\n\n//\n// --debug\n//\n\nif (debug === true) {\n  watcherOpts.debug = debug;\n}\n\nconst watcher = createWatcher(watcherOpts);\n\nwatcher.addListener(\"error\", err => {\n  process.stderr.write(msg(\"error\", err));\n});\n\nwatcher.addListener(\"change\", evt => {\n  if (debug === true) {\n    process.stdout.write(msg(\"change\", evt));\n  }\n});\n\nwatcher.addListener(\"proc-error\", err => {\n  process.stderr.write(msg(\"proc-error\", err));\n});\n\nwatcher.addListener(\"proc-disconnect\", err => {\n  if (debug === true) {\n    process.stdout.write(msg(\"proc-disconnect\", err));\n  }\n});\n\nwatcher.addListener(\"proc-close\", err => {\n  if (debug === true) {\n    process.stdout.write(msg(\"proc-close\", err));\n  }\n});\n\nwatcher.addListener(\"proc-exit\", err => {\n  if (debug === true) {\n    process.stdout.write(msg(\"proc-exit\", err));\n  }\n});\n\nwatcher.stdout.pipe(process.stdout);\nwatcher.stderr.pipe(process.stderr);\n\nwatcher.addListener(\"started\", () => {\n  if (debug === true) {\n    process.stdout.write(msg(\"started\"));\n  }\n});\n\nwatcher.start();\n"],"file":"cli.js"}